<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana åœ°å€æ—¥äº¤æ˜“ç»Ÿè®¡å·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 min-h-screen text-gray-800">

<div class="max-w-4xl mx-auto py-12 px-4">
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h1 class="text-2xl font-bold text-gray-900 mb-2 flex items-center">
            <span class="mr-2">ğŸ“Š</span> Solana åœ°å€æ—¥äº¤æ˜“ç»Ÿè®¡
        </h1>
        <p class="text-sm text-gray-500 mb-6">è¾“å…¥ Solana é’±åŒ…åœ°å€ï¼Œè·å–è¯¥åœ°å€æœ€è¿‘çš„æ¯æ—¥äº¤æ˜“æ´»è·ƒåº¦ç»Ÿè®¡ã€‚</p>

        <div class="flex flex-col md:flex-row gap-3">
            <input
                    type="text"
                    id="addressInput"
                    placeholder="è¯·è¾“å…¥ SOL é’±åŒ…åœ°å€ (å¦‚: 675kPX...)"
                    class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:outline-none"
            >
            <button
                    onclick="fetchStats()"
                    id="btnText"
                    class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-6 rounded-lg transition duration-200 disabled:opacity-50"
            >
                å¼€å§‹åˆ†æ
            </button>
        </div>
        <p id="status" class="mt-3 text-sm text-purple-600 font-medium"></p>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-6">
        <canvas id="txChart" width="400" height="200"></canvas>
        <div id="emptyState" class="py-20 text-center text-gray-400">
            æš‚æ— æ•°æ®ï¼Œè¯·åœ¨ä¸Šæ–¹è¾“å…¥åœ°å€å¹¶ç‚¹å‡»åˆ†æ
        </div>
    </div>
</div>

<script>

// 1. ç¦ç”¨é¼ æ ‡å³é”®
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
}, false);

// 2. ç¦ç”¨ F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U (æŸ¥çœ‹æºç )
document.addEventListener('keydown', function(e) {
    // æ‹¦æˆª F12
    if (e.key === "F12") {
        e.preventDefault();
        return false;
    }
    // æ‹¦æˆª Ctrl+Shift+I (Chrome/Edge/Brave å¼€å‘è€…å·¥å…·)
    if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i')) {
        e.preventDefault();
        return false;
    }
    // æ‹¦æˆª Ctrl+Shift+J (æ§åˆ¶å°)
    if (e.ctrlKey && e.shiftKey && (e.key === 'J' || e.key === 'j')) {
        e.preventDefault();
        return false;
    }
    // æ‹¦æˆª Ctrl+U (æŸ¥çœ‹æºä»£ç )
    if (e.ctrlKey && (e.key === 'U' || e.key === 'u')) {
        e.preventDefault();
        return false;
    }
    // æ‹¦æˆª Cmd+Option+I (Mac ç”¨æˆ·å¸¸ç”¨)
    if (e.metaKey && e.altKey && (e.key === 'I' || e.key === 'i')) {
        e.preventDefault();
        return false;
    }
}, false);

    let myChart = null;

    async function fetchStats() {
    const address = document.getElementById('addressInput').value.trim();
    const btn = document.getElementById('btnText');
    const status = document.getElementById('status');
    const emptyState = document.getElementById('emptyState');

    if (!address) {
        alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ Solana åœ°å€");
        return;
    }

    // åˆå§‹åŒ–è¿æ¥ (è¯·ç¡®ä¿æ¢æˆä½ çš„ Helius URL)
    const RPC_URL = "https://mainnet.helius-rpc.com/?api-key=401bf178-3c34-4f65-a0d1-bfdbeb9d3899";
    const connection = new solanaWeb3.Connection(RPC_URL);
    let pubKey = new solanaWeb3.PublicKey(address);

    // è®¡ç®—ä¸¤å‘¨å‰çš„æ—¶é—´æˆ³ (å½“å‰æ—¶é—´ - 14å¤©)
    const TWO_WEEKS_AGO = Math.floor(Date.now() / 1000) - (14 * 24 * 60 * 60);

    btn.disabled = true;
    btn.innerText = "åˆ†æä¸­...";
    status.innerText = "æ­£åœ¨æŠ“å–æœ€è¿‘ä¸¤å‘¨çš„äº¤æ˜“æ•°æ®...";
    emptyState.style.display = "none";

    let allSignatures = [];
    let lastSignature = null;
    let keepFetching = true;

    try {
        while (keepFetching) {
            const options = { limit: 1000 };
            if (lastSignature) options.before = lastSignature;

            const signatures = await connection.getSignaturesForAddress(pubKey, options);
            
            if (signatures.length === 0) break;

            for (let sig of signatures) {
                // å¦‚æœäº¤æ˜“æ—¶é—´æ—©äºä¸¤å‘¨å‰ï¼Œåœæ­¢æŠ“å–
                if (sig.blockTime < TWO_WEEKS_AGO) {
                    keepFetching = false;
                    break;
                }

                // --- å…³é”®ä¿®æ”¹ï¼šå‰”é™¤å¤±è´¥ç¬”æ•° ---
                if (sig.err === null) {
                    allSignatures.push(sig);
                }

            }

            lastSignature = signatures[signatures.length - 1].signature;

            // å®‰å…¨é˜€ï¼šé˜²æ­¢æŸäº›æé«˜é¢‘åœ°å€å¯¼è‡´æµè§ˆå™¨å´©æºƒï¼ˆé™åˆ¶æœ€å¤šæŠ“å– 10000 æ¡ï¼‰
            if (allSignatures.length > 10000) {
                status.innerText = "æ•°æ®é‡è¿‡å¤§ï¼Œä»…æ˜¾ç¤ºæœ€è¿‘çº¦ 10,000 æ¡è®°å½•...";
                break;
            }
            
            status.innerText = `å·²è·å– ${allSignatures.length} ç¬”äº¤æ˜“...`;
        }

        if (allSignatures.length === 0) {
            status.innerText = "æœ€è¿‘ä¸¤å‘¨å†…è¯¥åœ°å€æ— äº¤æ˜“ã€‚";
            return;
        }

        // ç»Ÿè®¡æ¯æ—¥æ•°æ®
        const stats = {};
        allSignatures.forEach(sig => {
            const date = new Date(sig.blockTime * 1000).toLocaleDateString('zh-CN');
            stats[date] = (stats[date] || 0) + 1;
        });

        // æ’åºå¹¶æ ¼å¼åŒ–å›¾è¡¨
        const sortedData = Object.entries(stats)
            .map(([date, count]) => ({ date, count }))
            .sort((a, b) => new Date(a.date) - new Date(b.date));

        renderChart(sortedData);
        status.innerText = `å®Œæˆï¼å…±ç»Ÿè®¡äº†ä¸¤å‘¨å†… ${allSignatures.length} ç¬”äº¤æ˜“ã€‚`;

    } catch (err) {
        console.error(err);
        status.innerText = "é”™è¯¯: " + err.message;
    } finally {
        btn.disabled = false;
        btn.innerText = "å¼€å§‹åˆ†æ";
    }
}

    function renderChart(data) {
        const ctx = document.getElementById('txChart').getContext('2d');

        // å¦‚æœå·²æœ‰å›¾è¡¨åˆ™é”€æ¯é‡ç»˜
        if (myChart) {
            myChart.destroy();
        }

        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.map(d => d.date),
                datasets: [{
                    label: 'æ¯æ—¥äº¤æ˜“ç¬”æ•°',
                    data: data.map(d => d.count),
                    backgroundColor: 'rgba(139, 92, 246, 0.6)',
                    borderColor: 'rgb(139, 92, 246)',
                    borderWidth: 1,
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1 }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: { mode: 'index', intersect: false }
                }
            }
        });
    }
</script>
</body>
</html>